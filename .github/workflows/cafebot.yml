name: CafeBot

on:
  schedule:
    - cron: '0 14-15 * * 1-5'

jobs:
  clean:
    name: Cleaner Call
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - uses: szenius/set-timezone@v1.0
        with:
          timezoneLinux: "Europe/Prague"

      - name: Current hour
        id: hour
        run: echo "::set-output name=hour::$(date +"%H")"

      - uses: shivammathur/setup-php@v2
        with:
          php-version: 7.4

      - if: ${{ steps.hour.outputs.hour == '16' }}
        run: |
          composer install
          php bin/index.php
        env:
          CAFEBOT_CLEANERS: ${{ secrets.CAFEBOT_CLEANERS }}
          CAFEBOT_WEBHOOK: ${{ secrets.CAFEBOT_WEBHOOK }}
